// Generated by CoffeeScript 1.4.0
var items, updateStore, _;

items = require('habitrpg-shared/script/items');

_ = require('lodash');

updateStore = function(model) {
  var nextItems;
  nextItems = items.updateStore(model.get('_user'));
  return _.each(nextItems, function(v, k) {
    model.set("_items.next." + k, v);
    return true;
  });
};

/*
  server exports
*/


module.exports.server = function(model) {
  model.set('_items', items.items);
  return updateStore(model);
};

/*
  app exports
*/


module.exports.app = function(appExports, model) {
  var misc;
  misc = require('./misc');
  model.on("set", "_user.items.*", function() {
    return updateStore(model);
  });
  appExports.buyItem = function(e, el) {
    return misc.batchTxn(model, function(uObj, paths) {
      var ret;
      ret = items.buyItem(uObj, $(el).attr('data-type'), {
        paths: paths
      });
      if (ret === false) {
        return alert("Not enough GP");
      }
    });
  };
  appExports.activateRewardsTab = function() {
    model.set('_activeTabRewards', true);
    return model.set('_activeTabPets', false);
  };
  return appExports.activatePetsTab = function() {
    model.set('_activeTabPets', true);
    return model.set('_activeTabRewards', false);
  };
};
